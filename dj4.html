<!DOCTYPE html>
<html>
<head>
  <title>Hindi Pop 2024-2025 Video Player</title>
  <style>
    video {
      width: 100%;
      height: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      display: none; /* Hidden until play button is clicked */
    }
    button {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px 40px;
      font-size: 24px;
      cursor: pointer;
      z-index: 1001;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <video id="player"></video>
  <button id="playButton">Play</button>

  <script>
    const player = document.getElementById('player');
    const playButton = document.getElementById('playButton');
    const originalPlaylist = [
      { 
        title: "Jatt Mehkma - GLORY by Yo Yo Honey Singh", 
        url: "https://pagalworld.video/files/download/type/320/id/2360", 
        duration: 243 
      },
      { 
        title: "Attach | Sidhu Moose Wala ft Fredo", 
        url: "https://pagalworld.video/files/download/type/320/id/2303", 
        duration: 306 
      }
    ];

    // Deterministic shuffle function using a seed
    function seededShuffle(array, seed) {
      const newArray = [...array];
      let m = newArray.length, t, i;
      function seededRandom() {
        const x = Math.sin(seed++) * 10000;
        return x - Math.floor(x);
      }
      while (m) {
        i = Math.floor(seededRandom() * m--);
        t = newArray[m];
        newArray[m] = newArray[i];
        newArray[i] = t;
      }
      return newArray;
    }

    // Use startTime as the seed for consistent shuffling across users
    const startTime = new Date("2025-04-20T00:00:00Z").getTime();
    const playlist = seededShuffle(originalPlaylist, startTime / 1000);
    const totalDuration = playlist.reduce((sum, song) => sum + song.duration, 0); // 477 seconds
    let currentSongUrl = '';
    let hasEnteredFullscreen = false;

    function enterFullScreen() {
      if (hasEnteredFullscreen) return;
      try {
        if (player.requestFullscreen) {
          player.requestFullscreen();
        } else if (player.webkitRequestFullscreen) {
          player.webkitRequestFullscreen();
        } else if (player.msRequestFullscreen) {
          player.msRequestFullscreen();
        }
        console.log("Full Screen Requested");
        hasEnteredFullscreen = true;
      } catch (e) {
        console.error("Full Screen Error:", e);
      }
    }

    function syncVideo() {
      const now = Date.now();
      const elapsedSeconds = (now - startTime) / 1000;
      const playlistPosition = elapsedSeconds % totalDuration;

      let accumulatedTime = 0;
      let currentSong = null;
      for (let i = 0; i < playlist.length; i++) {
        accumulatedTime += playlist[i].duration;
        if (playlistPosition < accumulatedTime) {
          currentSong = playlist[i];
          break;
        }
      }

      const songStartTime = accumulatedTime - currentSong.duration;
      const positionInSong = playlistPosition - songStartTime;

      console.log(`Syncing: ${currentSong.title} at ${positionInSong.toFixed(2)}s`);

      if (currentSongUrl !== currentSong.url) {
        player.src = currentSong.url;
        currentSongUrl = currentSong.url;
        console.log(`Loading new video: ${currentSong.url}`);
      }
      player.currentTime = positionInSong;
    }

    player.addEventListener('ended', () => {
      console.log("Song Ended, Switching Track");
      syncVideo();
      player.play().catch(e => console.error("Playback failed:", e));
    });

    // Play button click handler
    playButton.addEventListener('click', () => {
      // Hide the play button
      playButton.style.display = 'none';
      // Show the video
      player.style.display = 'block';
      // Sync and start playback
      syncVideo();
      player.play().catch(e => console.error("Playback failed:", e));
      // Enter fullscreen
      enterFullScreen();
    });

    // Sync on page load (set correct song and position, but don't play)
    syncVideo();
    // Sync every 10 minutes (600,000 milliseconds)
    setInterval(syncVideo, 600000);
  </script>
</body>
</html>

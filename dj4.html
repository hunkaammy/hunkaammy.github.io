<!DOCTYPE html>
<html>
<head>
  <title>Hindi Pop 2024-2025 Custom Player Sync</title>
  <style>
    video {
      width: 100%;
      height: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
    }
    .info {
      position: fixed;
      bottom: 10px;
      left: 10px;
      color: white;
      background: rgba(0, 0, 0, 0.7);
      padding: 5px;
      z-index: 1001;
    }
  </style>
</head>
<body>
  <video id="player" controls autoplay></video>
  <div class="info">Now playing: <span id="currentSong">Loading...</span></div>

  <script>
    const player = document.getElementById('player');
    const originalPlaylist = [
      { 
        title: "Nadaaniyan | Akshath Acharya", 
        url: "https://pagalworld.video/files/download/id/2379", 
        duration: 171 
      },
      { 
        title: "Attach | Sidhu Moose Wala ft Fredo", 
        url: "https://pagalworld.video/files/download/type/320/id/2303", 
        duration: 306 
      }
    ];

    // Deterministic shuffle function using a seed
    function seededShuffle(array, seed) {
      const newArray = [...array];
      let m = newArray.length, t, i;
      // Use a simple seeded random number generator
      function seededRandom() {
        const x = Math.sin(seed++) * 10000;
        return x - Math.floor(x);
      }
      while (m) {
        i = Math.floor(seededRandom() * m--);
        t = newArray[m];
        newArray[m] = newArray[i];
        newArray[i] = t;
      }
      return newArray;
    }

    // Use startTime as the seed for consistent shuffling across users
    const startTime = new Date("2025-04-20T00:00:00Z").getTime();
    const playlist = seededShuffle(originalPlaylist, startTime / 1000);
    const totalDuration = playlist.reduce((sum, song) => sum + song.duration, 0); // 477 seconds
    let currentSongUrl = '';
    let hasEnteredFullscreen = false;

    function enterFullScreen() {
      if (hasEnteredFullscreen) return; // Prevent repeated fullscreen requests
      try {
        if (player.requestFullscreen) {
          player.requestFullscreen();
        } else if (player.webkitRequestFullscreen) {
          player.webkitRequestFullscreen();
        } else if (player.msRequestFullscreen) {
          player.msRequestFullscreen();
        }
        console.log("Full Screen Requested");
        hasEnteredFullscreen = true;
      } catch (e) {
        console.error("Full Screen Error:", e);
      }
    }

    function syncVideo() {
      const now = Date.now();
      const elapsedSeconds = (now - startTime) / 1000;
      const playlistPosition = elapsedSeconds % totalDuration;

      let accumulatedTime = 0;
      let currentSong = null;
      for (let i = 0; i < playlist.length; i++) {
        accumulatedTime += playlist[i].duration;
        if (playlistPosition < accumulatedTime) {
          currentSong = playlist[i];
          break;
        }
      }

      const songStartTime = accumulatedTime - currentSong.duration;
      const positionInSong = playlistPosition - songStartTime;

      console.log(`Syncing: ${currentSong.title} at ${positionInSong.toFixed(2)}s`);

      if (currentSongUrl !== currentSong.url) {
        player.src = currentSong.url;
        currentSongUrl = currentSong.url;
        console.log(`Loading new video: ${currentSong.url}`);
      }
      player.currentTime = positionInSong;

      if (player.paused) {
        player.play().catch(e => console.error("Playback failed:", e));
      }

      document.getElementById('currentSong').textContent = currentSong.title;
    }

    player.addEventListener('ended', () => {
      console.log("Song Ended, Switching Track");
      syncVideo();
    });

    // Sync and enter fullscreen on page load
    syncVideo();
    enterFullScreen();
    // Sync every 10 minutes (600,000 milliseconds)
    setInterval(syncVideo, 600000);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HINDUSTAN TOYS ORDER PORTAL</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
  <link rel="stylesheet" href="https://fezvrasta.github.io/bootstrap-material-design/dist/css/bootstrap-material-design.css">
  <link rel="stylesheet" href="https://fezvrasta.github.io/bootstrap-material-design/dist/css/ripples.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size: 13px;
      line-height: 1.5;
      color: #333;
      background-color: #f8f9fa;
      overscroll-behavior-y: none;
      margin: 0;
    }

    html {
      font-size: 10px;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
    }

    /* Login Container */
    #login-container {
      background-image: url(https://hunkaammy.github.io/mywebsite/NEWWEBSITE/loginpg.jpeg);
      background-size: cover;
      background-position: center;
      height: 100vh;
      max-width: 100%;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #inside {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      text-align: center;
      width: 100%;
      max-width: 360px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      box-sizing: border-box;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ced4da;
      transition: border-color 0.2s;
    }

    input:focus {
      border-color: #388e3c;
      outline: none;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #388e3c;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.25s;
    }

    button:hover {
      background-color: #2e7d32;
    }

    /* Navbar */
    .navbar {
      background-color: #fff;
      padding: 6px 10px;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .navbar .search-container {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px;
    }

    #topBtn {
      flex: 1;
      padding: 8px;
      font-size: 11px;
      border-radius: 6px;
      border: 1px solid #ced4da;
    }

    .sort-dropdown {
      padding: 8px;
      font-size: 11px;
      border-radius: 6px;
      border: 1px solid #ced4da;
    }

    .sort-dropdown option[selected] {
      font-weight: bold;
    }

    .logout-btn {
      color: #333;
      font-size: 11px;
      cursor: pointer;
      padding: 8px;
      font-weight: 500;
    }

    .welcome-text {
      text-align: center;
      color: #333;
      font-size: 12px;
      margin-top: 6px;
      font-weight: 500;
    }

    /* Product Grid */
    .skeleton-wrapper {
      width: 95%;
      margin: 60px auto 16px auto;
      padding: 0 6px;
    }

    .grid-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 8px;
    }

    @media (max-width: 480px) {
      .skeleton-wrapper {
        width: 81%;
        margin-left: 64px;
        margin-top: 92px;
      }
      .grid-row {
        gap: 6px;
        margin-bottom: 6px;
      }
    }

    .card {
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
      transition: transform 0.25s, box-shadow 0.25s;
      width: 100%;
      max-width: 160px;
      margin: 0 auto;
      border-radius: 8px;
      text-align: center;
      background: #fff;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.12);
    }

    .card img {
      width: 100%;
      max-width: 140px;
      height: auto;
      margin: 4px auto;
      border-radius: 6px;
      object-fit: cover;
      cursor: pointer;
    }

    @media (max-width: 480px) {
      .card {
        max-width: 140px;
      }
      .card img {
        max-width: 140px;
      }
    }

    .containers {
      padding: 4px;
    }

    .qtyclass {
      height: 30px;
      width: 46px;
      margin: 6px 4px 0 0;
      font-size: 11px;
      border-radius: 4px;
      border: 1px solid #ced4da;
    }

    .submit {
      cursor: pointer;
      background: #fff;
      color: #388e3c;
      font-weight: 600;
      width: 46px;
      height: 30px;
      border: 1px solid #388e3c;
      border-radius: 4px;
      margin: 6px 0 0 4px;
      font-size: 11px;
    }

    .submit:hover {
      background: #388e3c;
      color: #fff;
    }

    .btn-primary {
      position: fixed;
      bottom: 12px;
      right: 12px;
      color: #fff;
      background-color: #1565c0;
      border-color: #1565c0;
      z-index: 1;
      padding: 8px 16 Pragma warning: Potential null pointer dereference
      padding: 8px 16px;
      font-size: 12px;
      border-radius: 6px;
    }

    p {
      margin: 0 0 4px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      font-size: 11px;
    }

    h4 {
      margin: 0 0 4px;
      font-size: 12px;
      color: #333;
    }

    /* Enlarged Image Overlay */
    .enlarged-image-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      cursor: pointer;
    }

    .enlarged-image-overlay.show {
      display: flex;
    }

    .enlarged-image-content {
      max-width: 90%;
      max-height: 90%;
      width: auto;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

        @media (max-width: 480px) {
      .enlarged-image-content{
        max-width: 89%;
        MARGIN-TOP: 38%;
        MARGIN-LEFT: 6%;
        ALIGN-CONTENT: CENTER;
        max-height: 93%;
    }
    }

    /* Tabs */
    .tab-scroll-wrapper {
     
      overflow-y: auto;
      height: calc(100vh - 50px);
      position: fixed;
      width: 66px;
      background: #fff;
      padding: 4px;
      box-shadow: 2px 0 4px rgba(0,0,0,0.1);
      -webkit-overflow-scrolling: touch;
    }

    .tab-items {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tab-item {
      width: 60px;
      height: 66px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background-color: #f8f9fa;
      border-radius: 6px;
      text-align: center;
      font-family: Arial, sans-serif;
      font-size: 7px;
      color: #333;
      cursor: pointer;
      transition: background-color 0.25s, transform 0.25s;
    }

    .tab-item:hover {
      background-color: #e9ecef;
      transform: scale(1.05);
    }

    .tab-item.active {
      background-color: #388e3c;
      color: #fff;
      font-weight: bold;
      height: 72px;
    }

    .tab-item img {
      width: 32px;
      height: 32px;
      object-fit: cover;
      margin: 4px auto;
      border-radius: 4px;
    }

    .tab-scroll-wrapper::-webkit-scrollbar {
      display: none;
    }

    .tab-scroll-wrapper {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* Skeleton Loading */
    .skeleton-item {
      width: 100%;
      max-width: 160px;
      height: 200px;
      background-color: #e9ecef;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      animation: skeleton-pulse 1.5s ease-in-out infinite;
      margin: 0 auto;
    }

    @media (max-width: 480px) {
      .skeleton-item {
        max-width: 140px;
        height: 180px;
      }
    }

    @keyframes skeleton-pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }

    .skeleton-item .skeleton-text {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px;
    }

    .skeleton-item .skeleton-line {
      width: 100%;
      height: 10px;
      background-color: #dee2e6;
      margin-bottom: 6px;
      border-radius: 4px;
    }

    /* Microphone Animation */
    @keyframes pulse {
      0% { transform: scale(1); color: #333; }
      50% { transform: scale(1.2); color: #1565c0; }
      100% { transform: scale(1); color: #333; }
    }

    #micIcon.animating {
      animation: pulse 1s infinite;
    }
  </style>
</head>
<body ng-controller="imagesController as vm">
  <!-- Prevent Browser Back -->
  <script>
    history.pushState(null, null, location.href);
    window.onpopstate = function () {
      history.go(1);
    };
  </script>

  <!-- Login Section -->
  <div id="login-container">
    <div id="inside">
      <h2 style="font-size: 18px; margin-bottom: 20px; color: #333;">WELCOME TO HINDUSTAN TOYS</h2>
      <input type="text" id="name" ng-model="dynamicField2Value" placeholder="Enter your shop name" autocomplete="off">
      <input type="tel" id="mobile" placeholder="Enter your mobile number" autocomplete="off">
      <button onclick="validateLogin()">Login</button>
    </div>
  </div>

  <!-- Main Content -->
  <div id="content" style="display: none;">
    <!-- Navbar -->
    <div class="navbar">
      <div class="search-container">
        <input type="text" ng-model="searchQuery" placeholder="Search by product" id="topBtn" ng-click="resetFilters()" list="productNames">
        <datalist id="productNames">
          <option value="REMOTE CAR"></option>
          <option value="JCB"></option>
          <option value="CLAY"></option>
          <option value="SLIME"></option>
          <option value="GUN"></option>
          <option value="BASKET BALL"></option>
        </datalist>
        <i id="micIcon" class="fas fa-microphone" onclick="startVoiceRecognition()" style="font-size: 15px; cursor: pointer; margin-left: 6px;"></i>
        <div class="logout-btn" ng-click="logout()">Logout</div>
        <div>
          <label for="sort" style="font-size: 11px; margin-right: 4px;">Sort:</label>
          <select id="sort" ng-model="sortOrder" ng-change="scrollToTop(); applyFilter()" ng-init="sortOrder='default'" class="sort-dropdown">
            <option value="default" selected>Default</option>
            <option value="price">Price: Low</option>
            <option value="-price">Price: High</option>
          </select>
        </div>
      </div>
      <div class="welcome-text">Welcome {{dynamicField2Value}}</div>
    </div>

    <!-- Tabs -->
    <div class="tab-scroll-wrapper">
      <div class="tab-items" onclick="scrollToTop()">
        <div class="tab-item" ng-click="setTab('', 0)" ng-class="{ 'active': activeTab === 0 }">
          <img src="https://www.hindustantoys.in/images/all.jpeg" alt="All Products"> ALL PRODUCTS
        </div>
        <div class="tab-item" ng-click="setTab('UMBRELLA', 38)" ng-class="{ 'active': activeTab === 38 }">
          <img src="https://firebasestorage.googleapis.com/v0/b/htshop-e9c51.appspot.com/o/2024-06-24T16%3A35%3A31.407Z_RAINBOW%20UMBRELLA_IMG-20240529-WA0047.jpg?alt=media&token=64ee5147-65c7-4de8-897d-55df6cb84857" alt="Umbrella"> UMBRELLA
        </div>
        <div class="tab-item" ng-click="setTab('LUMO', 10)" ng-class="{ 'active': activeTab === 10 }">
          <img src="https://www.hindustantoys.in/images/lumo.jpeg" alt="Lumo Products"> LUMO & OTHER
        </div>
        <div class="tab-item" ng-click="setTab('BAT BALL', 36)" ng-class="{ 'active': activeTab === 36 }">
          <img src="https://www.hindustantoys.in/images/bat.jpeg" alt="Bat Ball"> BAT BALL & SET
        </div>
        <div class="tab-item" ng-click="setTab('CARROM', 35)" ng-class="{ 'active': activeTab === 35 }">
          <img src="https://www.hindustantoys.in/images/carrom.jpeg" alt="Carrom Board"> CARROM BOARD
        </div>
        <div class="tab-item" ng-click="setTab('SWING', 37)" ng-class="{ 'active': activeTab === 37 }">
          <img src="https://www.hindustantoys.in/images/swing.jpeg" alt="Swings"> SWINGS
        </div>
        <div class="tab-item" ng-click="setTab('INDIAN TOYS', 3)" ng-class="{ 'active': activeTab === 3 }">
          <img src="https://www.hindustantoys.in/images/JCB.jpeg" alt="Indian Toys"> INDIAN TOYS
        </div>
        <div class="tab-item" ng-click="setTab('MIX', 9)" ng-class="{ 'active': activeTab === 9 }">
          <img src="https://www.hindustantoys.in/images/mix.jpeg" alt="Mix Toys"> MIX TOYS
        </div>
        <div class="tab-item" ng-click="setTab('BATTERY', 13)" ng-class="{ 'active': activeTab === 13 }">
          <img src="https://www.hindustantoys.in/images/battery.jpeg" alt="Battery Operated"> BATTERY OPERATED
        </div>
        <div class="tab-item" ng-click="setTab('TEDDY', 34)" ng-class="{ 'active': activeTab === 34 }">
          <img src="https://www.hindustantoys.in/images/TEDDY.jpg" alt="Teddy"> VALENTINES/TEDDY
        </div>
        <div class="tab-item" ng-click="setTab('KITCHEN', 31)" ng-class="{ 'active': activeTab === 31 }">
          <img src="https://www.hindustantoys.in/images/KITCHEN.jpg" alt="Kitchen Sets"> KITCHEN SETS
        </div>
        <div class="tab-item" ng-click="setTab('RACKET', 6)" ng-class="{ 'active': activeTab === 6 }">
          <img src="https://www.hindustantoys.in/images/racket.jpeg" alt="Racket"> RACKET
        </div>
        <div class="tab-item" ng-click="setTab('REMOTE', 7)" ng-class="{ 'active': activeTab === 7 }">
          <img src="https://www.hindustantoys.in/images/remote.jpeg" alt="Remote Car"> REMOTE CAR
        </div>
        <div class="tab-item" ng-click="setTab('RIDDER', 11)" ng-class="{ 'active': activeTab === 11 }">
          <img src="https://www.hindustantoys.in/images/ridder.jpeg" alt="Magic Ridder"> MAGIC RIDDER
        </div>
        <div class="tab-item" ng-click="setTab('HIGH QUALITY', 25)" ng-class="{ 'active': activeTab === 25 }">
          <img src="https://www.hindustantoys.in/images/high.jpeg" alt="High Quality Indian Toys"> HIGH QUALITY
        </div>
        <div class="tab-item" ng-click="setTab('OWN', 30)" ng-class="{ 'active': activeTab === 30 }">
          <img src="https://www.hindustantoys.in/images/htquality.jpg" alt="HT Products"> HT PRODUCTS
        </div>
        <div class="tab-item" ng-click="setTab('PALNA', 29)" ng-class="{ 'active': activeTab === 29 }">
          <img src="https://www.hindustantoys.in/images/palna.png" alt="Palna"> PALNA
        </div>
        <div class="tab-item" ng-click="setTab('WALKER', 5)" ng-class="{ 'active': activeTab === 5 }">
          <img src="https://www.hindustantoys.in/images/walker.jpeg" alt="Walker"> WALKER
        </div>
        <div class="tab-item" ng-click="setTab('LUNCH BOX', 28)" ng-class="{ 'active': activeTab === 28 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Lunch Box"> LUNCH BOX
        </div>
        <div class="tab-item" ng-click="setTab('PENCIL BOX', 27)" ng-class="{ 'active': activeTab === 27 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Pencil Box"> PENCIL BOX
        </div>
        <div class="tab-item" ng-click="setTab('BOTTLE', 23)" ng-class="{ 'active': activeTab === 23 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Water Bottle"> WATER BOTTLE
        </div>
        <div class="tab-item" ng-click="setTab('BOARD GAME', 26)" ng-class="{ 'active': activeTab === 26 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Board Game"> BOARD GAME
        </div>
        <div class="tab-item" ng-click="setTab('EDUCATIONAL', 22)" ng-class="{ 'active': activeTab === 22 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Educational Toys"> EDUCATIONAL
        </div>
        <div class="tab-item" ng-click="setTab('BIG', 21)" ng-class="{ 'active': activeTab === 21 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Big Items"> BIG
        </div>
        <div class="tab-item" ng-click="setTab('STUDY TABLE', 20)" ng-class="{ 'active': activeTab === 20 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Study Table"> STUDY TABLE
        </div>
        <div class="tab-item" ng-click="setTab('TRICYCLE', 19)" ng-class="{ 'active': activeTab === 19 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Tricycles"> TRICYCLES
        </div>
        <div class="tab-item" ng-click="setTab('SPORTS', 18)" ng-class="{ 'active': activeTab === 18 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Sports Item"> SPORTS ITEM
        </div>
        <div class="tab-item" ng-click="setTab('PATTA', 17)" ng-class="{ 'active': activeTab === 17 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Patta Items"> PATTA ITEMS
        </div>
        <div class="tab-item" ng-click="setTab('GUN', 15)" ng-class="{ 'active': activeTab === 15 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Guns Variety"> GUNS VARIETY
        </div>
        <div class="tab-item" ng-click="setTab('STATIONERY', 1)" ng-class="{ 'active': activeTab === 1 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Stationery Items"> STATIONERY
        </div>
        <div class="tab-item" ng-click="setTab('DOLL', 8)" ng-class="{ 'active': activeTab === 8 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Doll"> DOLL
        </div>
        <div class="tab-item" ng-click="setTab('FANCY', 12)" ng-class="{ 'active': activeTab === 12 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Fancy Items"> FANCY ITEMS
        </div>
        <div class="tab-item" ng-click="setTab('DOZEN', 14)" ng-class="{ 'active': activeTab === 14 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Dozen Packing"> DOZEN PACKING
        </div>
        <div class="tab-item" ng-click="setTab('G1', 32)" ng-class="{ 'active': activeTab === 32 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Godown-1"> GODOWN-1
        </div>
        <div class="tab-item" ng-click="setTab('G2', 33)" ng-class="{ 'active': activeTab === 33 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Godown-2"> GODOWN-2
        </div>
        <div class="tab-item" ng-click="setTab('GUN', 16)" ng-class="{ 'active': activeTab === 16 }">
          <img src="https://www.hindustantoys.in/images/DUMMY.jpeg" alt="Empty"> EMPTY
        </div>
      </div>
    </div>

    <!-- Product Grid -->
    <div class="skeleton-wrapper" ng-if="!vm.images.$resolved">
      <div class="grid-row">
        <div class="skeleton-item" ng-repeat="n in [].constructor(2) track by $index">
          <div class="skeleton-text">
            <div class="skeleton-line"></div>
            <div class="skeleton-line"></div>
            <div class="skeleton-line" style="width: 80%;"></div>
            <div class="skeleton-line" style="width: 50%;"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="skeleton-wrapper" ng-if="vm.images.$resolved">
      <div class="grid-row" ng-repeat="row in vm.getRows() track by $index">
        <div ng-repeat="image in row track by image.$id" ng-if="!image.outOfStock">
          <div class="card">
            <img src="{{image.url}}" alt="{{image.name}}" ng-click="showEnlargedImage(image.url)" loading="lazy">
            <button ng-if="!image.outOfStock && dynamicField2Value === 'sammyadmin'" class="btn btn-warning btn-sm" ng-click="markOutOfStock(image)" style="margin: 4px 0; font-size: 10px;">
              Mark Out of Stock
            </button>
            <div class="containers">
              <h4><b>{{image.price}} Rs.</b></h4>
              <p>{{image.name}}</p>
              <p><a href="https://hunkaammy.github.io/mywebsite/videos/{{image.videourl}}.mp4" target="_blank" ng-if="image.videourl" style="color: #1565c0;">Watch Video</a></p>
              <input type="hidden" id="{{'inputa' + ($parent.$index * 2 + $index)}}" ng-model="image.url">
              <input type="hidden" id="{{'inputb' + ($parent.$index * 2 + $index)}}" ng-model="dynamicField2Value" ng-value="dynamicField2Value">
              <input type="number" class="qtyclass" id="{{'inputc' + ($parent.$index * 2 + $index)}}" placeholder="Qty" ng-model="image.field3" ng-change="submitData(image, ($parent.$index * 2 + $index))" ng-model-options="{ debounce: 500 }">
              <p ng-show="showItemAdded" style="color: #388e3c; font-size: 10px;">Item Added</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enlarged Image Overlay -->
    <div id="enlarged-image-overlay" class="enlarged-image-overlay" ng-click="closeEnlargedImage()">
      <img class="enlarged-image-content" id="enlarged-image" src="" alt="Enlarged Image">
    </div>

    <!-- Order Modal -->
    <div class="container mt-3">
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">Your Order</button>
    </div>
    <div class="modal" id="myModal">
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">{{dynamicField2Value}} Your Order List</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal">Close</button>
          </div>
          <div class="modal-body">
            <object data="https://hunkaammy.github.io/mywebsite/NEWWEBSITE/order1#myInput={{dynamicField2Value}}" width="100%" height="400">
              <embed src="https://hunkaammy.github.io/mywebsite/cart#myInput=samrat" width="100%" height="400"> </embed>
              Error: Embedded data could not be displayed.
            </object>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.7/jquery.lazyload.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
  <script src="https://cdn.firebase.com/libs/angularfire/2.1.0/angularfire.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
  <script src="https://fezvrasta.github.io/bootstrap-material-design/dist/js/material.min.js"></script>

  <script>
    try {
      var firebaseConfig = {
        apiKey: "AIzaSyAr8dYBz_D1DVnGfT_fQhTwD1YmtTvuzMk",
        authDomain: "shop-reminder-3ce10.firebaseapp.com",
        databaseURL: "https://shop-reminder-3ce10-default-rtdb.firebaseio.com",
        projectId: "shop-reminder-3ce10",
        storageBucket: "shop-reminder-3ce10.appspot.com",
        messagingSenderId: "555627569260",
        appId: "1:555627569260:web:3948ae391eab6eb5ea7849",
        measurementId: "G-BP5EYR6ET1"
      };
      firebase.initializeApp(firebaseConfig);
    } catch (error) {
      console.error('Firebase initialization failed:', error.message, error.stack);
    }

    var blockedNumbers = ['7000913701', '9876543210', '9123456789', '8987854256', '9039199794'];

    function validateLogin() {
      try {
        var name = document.getElementById('name').value.trim();
        var mobile = document.getElementById('mobile').value.trim();
        if (name.length < 4) {
          alert('Please enter a valid shop name.');
          return;
        }
        if (!/^[6-9]\d{9}$/.test(mobile)) {
          alert('Please enter a valid mobile number.');
          return;
        }
        if (blockedNumbers.includes(mobile)) {
          window.location.href = '/mywebsite/NEWWEBSITE/blocked.html';
          return;
        }
        var lowerName = name.toLowerCase();
        if (lowerName === 'mohit chawla' || lowerName === 'honey digital' || lowerName === 'bab el mandeb' || lowerName === 'saha resources') {
          window.location.href = '/mywebsite/NEWWEBSITE/blocked.html';
          return;
        }
        var database = firebase.database();
        var userRef = database.ref('users').push({
          name: name,
          mobile: mobile,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        localStorage.setItem('name', name);
        localStorage.setItem('mobile', mobile);
        localStorage.setItem('loggedIn', 'true');
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('content').style.display = 'block';
      } catch (error) {
        console.error('validateLogin failed:', error.message, error.stack);
        alert('Login failed. Please try again.');
      }
    }

    function autoLogin() {
      try {
        var storedName = localStorage.getItem('name');
        var storedMobile = localStorage.getItem('mobile');
        if (storedMobile === '7000913701' || (storedName && storedName.toLowerCase() === 'mohit chawla')) {
          return;
        }
        if (storedName && storedMobile) {
          document.getElementById('name').value = storedName;
          document.getElementById('mobile').value = storedMobile;
          validateLogin();
        }
      } catch (error) {
        console.error('autoLogin failed:', error.message, error.stack);
      }
    }

    function logout() {
      try {
        localStorage.removeItem('name');
        localStorage.removeItem('mobile');
        localStorage.removeItem('loggedIn');
        window.location.href = 'https://hindustantoys.in/pagdi';
      } catch (error) {
        console.error('logout failed:', error.message, error.stack);
      }
    }

    window.onload = function() {
      try {
        autoLogin();
      } catch (error) {
        console.error('window.onload failed:', error.message, error.stack);
      }
    };

    function scrollToTop() {
      try {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } catch (error) {
        console.error('scrollToTop failed:', error.message, error.stack);
      }
    }

    function showEnlargedImage(src) {
      try {
        var overlay = document.getElementById('enlarged-image-overlay');
        var enlargedImg = document.getElementById('enlarged-image');
        if (overlay && enlargedImg) {
          enlargedImg.src = src;
          overlay.style.display = 'flex';
          overlay.classList.add('show');
        } else {
          console.error('showEnlargedImage: overlay or enlargedImg not found');
        }
      } catch (error) {
        console.error('showEnlargedImage failed:', error.message, error.stack);
      }
    }

    function closeEnlargedImage() {
      try {
        var overlay = document.getElementById('enlarged-image-overlay');
        if (overlay) {
          overlay.classList.remove('show');
          overlay.style.display = 'none';
        } else {
          console.error('closeEnlargedImage: overlay not found');
        }
      } catch (error) {
        console.error('closeEnlargedImage failed:', error.message, error.stack);
      }
    }

    function startVoiceRecognition() {
      try {
        const micIcon = document.getElementById('micIcon');
        if (!micIcon) {
          console.error('startVoiceRecognition: micIcon not found');
          return;
        }
        micIcon.classList.add('animating');
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        if (!recognition) {
          console.error('startVoiceRecognition: SpeechRecognition not supported');
          micIcon.classList.remove('animating');
          return;
        }
        recognition.lang = 'en-US';
        recognition.onresult = function(event) {
          try {
            const transcript = event.results[0][0].transcript;
            const topBtn = document.getElementById('topBtn');
            if (topBtn) {
              topBtn.value = transcript;
              angular.element(topBtn).scope().$apply(function($scope) {
                $scope.searchQuery = transcript;
              });
              filterData(transcript);
              scrollToTop();
            } else {
              console.error('startVoiceRecognition: topBtn not found');
            }
            setTimeout(() => micIcon.classList.remove('animating'), 500);
          } catch (error) {
            console.error('Speech recognition result failed:', error.message, error.stack);
          }
        };
        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error, event.message);
          micIcon.classList.remove('animating');
        };
        recognition.start();
      } catch (error) {
        console.error('startVoiceRecognition failed:', error.message, error.stack);
      }
    }

    function filterData(query) {
      try {
        angular.element(document.getElementById('topBtn')).scope().$apply(function($scope) {
          $scope.productNameFilter = query;
        });
      } catch (error) {
        console.error('filterData failed:', error.message, error.stack);
      }
    }
  </script>

  <script>
    try {
      var app = angular.module('myApp', ['firebase']);
      app.controller('imagesController', ['$scope', '$firebaseArray', '$window', '$location', '$timeout', function($scope, $firebaseArray, $window, $location, $timeout) {
        $scope.vm = this;
        $scope.vm.images = [];
        $scope.sortOrder = 'default';
        $scope.dynamicField2Value = localStorage.getItem('name') || '';
        $scope.searchQuery = '';
        $scope.productNameFilter = '';
        $scope.activeTab = 0;

        var firebaseConfigFetch = {
          apiKey: "AIzaSyAvlig_xWJNP1hFsl4qfisC01VTkOAVhT8",
          authDomain: "htshop-e9c51.firebaseapp.com",
          databaseURL: "https://htshop-e9c51-default-rtdb.firebaseio.com",
          projectId: "htshop-e9c51",
          storageBucket: "htshop-e9c51.appspot.com",
          messagingSenderId: "653137640907",
          appId: "1:653137640907:web:672fd6a9e85ca448a70a4e",
          measurementId: "G-FJ4Q0FHBEG"
        };
        var firebaseConfigSubmit = {
          apiKey: "AIzaSyAMFjDnZaszneoR6nO8bmXUxwZJplLvNfU",
          authDomain: "notes-12519.firebaseapp.com",
          databaseURL: "https://notes-12519-default-rtdb.firebaseio.com",
          projectId: "notes-12519",
          storageBucket: "notes-12519.appspot.com",
          messagingSenderId: "1073774450189",
          appId: "1:1073774450189:web:0b6d4a9f95823abbf36744",
          measurementId: "G-GZXYCJ33TR"
        };

        try {
          var firebaseFetch = firebase.initializeApp(firebaseConfigFetch, 'fetchApp');
          var firebaseSubmit = firebase.initializeApp(firebaseConfigSubmit, 'submitApp');
          var databaseFetch = firebaseFetch.database().ref();
          var listFetch = $firebaseArray(databaseFetch);
          var databaseSubmit = firebaseSubmit.database().ref();
          var listSubmit = $firebaseArray(databaseSubmit);

          $scope.vm.images = listFetch;
          listFetch.$loaded().then(function(data) {
            console.log('Firebase data loaded:', data.length, 'items');
            $scope.vm.images = data;
          }).catch(function(error) {
            console.error('Error loading Firebase data:', error.message, error.stack);
          });
        } catch (error) {
          console.error('Firebase initialization error:', error.message, error.stack);
        }

        $scope.vm.getRows = function() {
          try {
            var filteredImages = ($scope.vm.images || []).filter(function(image) {
              if (!image) return false;
              var matchesFilter = !$scope.productNameFilter || (image.name || '').toLowerCase().includes($scope.productNameFilter.toLowerCase());
              var matchesSearch = !$scope.searchQuery || (image.name || '').toLowerCase().includes($scope.searchQuery.toLowerCase());
              return !image.outOfStock && matchesFilter && matchesSearch;
            });

            if ($scope.sortOrder === 'default') {
              filteredImages.reverse();
            } else if ($scope.sortOrder === 'price') {
              filteredImages.sort(function(a, b) {
                return (Number(a.price) || 0) - (Number(b.price) || 0); // Low to High
              });
            } else if ($scope.sortOrder === '-price') {
              filteredImages.sort(function(a, b) {
                return (Number(b.price) || 0) - (Number(a.price) || 0); // High to Low
              });
            }

            console.log('Sorted images:', filteredImages.length, 'items, sortOrder:', $scope.sortOrder);
            if (filteredImages.length > 0) {
              console.log('Top item:', {
                name: filteredImages[0].name,
                id: filteredImages[0].$id,
                price: filteredImages[0].price
              });
            }

            var rows = [];
            for (var i = 0; i < filteredImages.length; i += 2) {
              rows.push(filteredImages.slice(i, i + 2));
            }
            return rows;
          } catch (error) {
            console.error('getRows failed:', error.message, error.stack);
            return [];
          }
        };

        function getUrlParameter(name) {
          try {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec($location.absUrl());
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
          } catch (error) {
            console.error('getUrlParameter failed:', error.message, error.stack);
            return '';
          }
        }

        try {
          var filterParam = getUrlParameter('filter');
          var tabParam = getUrlParameter('tab');
          $scope.productNameFilter = filterParam || '';
          $scope.activeTab = isNaN(tabParam) ? 0 : parseInt(tabParam, 10);
        } catch (error) {
          console.error('URL parameter initialization failed:', error.message, error.stack);
        }

        $scope.setTab = function(filter, tab) {
          try {
            $scope.productNameFilter = filter;
            $scope.activeTab = tab;
            $scope.searchQuery = '';
            $scope.sortOrder = 'default';
            $location.search('filter', filter);
            $location.search('tab', tab);
            scrollToTop();
          } catch (error) {
            console.error('setTab failed:', error.message, error.stack);
          }
        };

        $scope.resetFilters = function() {
          try {
            $scope.productNameFilter = '';
            $scope.activeTab = 0;
            $scope.searchQuery = '';
            $scope.sortOrder = 'default';
            $location.search('filter', '');
            $location.search('tab', 0);
            scrollToTop();
          } catch (error) {
            console.error('resetFilters failed:', error.message, error.stack);
          }
        };

        $scope.submitData = function(image, index) {
          try {
            if (!image) {
              console.error('submitData: image is null or undefined');
              return;
            }
            var inputa = image.url || '';
            var inputb = $scope.dynamicField2Value || '';
            var inputc = image.field3 || 0;
            var currentDate = new Date();
            var day = String(currentDate.getDate()).padStart(2, '0');
            var month = String(currentDate.getMonth() + 1).padStart(2, '0');
            var year = currentDate.getFullYear();
            var submitDate = day + '-' + month + '-' + year;
            var hours = currentDate.getHours();
            var minutes = String(currentDate.getMinutes()).padStart(2, '0');
            var ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;
            var submitTime = hours + ':' + minutes + ' ' + ampm;

            if (image.quantityId) {
              databaseSubmit.child(image.quantityId).update({
                field3: inputc
              }).then(() => {
                $scope.showItemAdded = true;
                $timeout(() => {
                  $scope.showItemAdded = false;
                }, 2000);
              }).catch((error) => {
                console.error('Error updating quantity:', error.message, error.stack);
              });
            } else {
              var newDataKey = databaseSubmit.push().key;
              image.quantityId = newDataKey;
              databaseSubmit.child(newDataKey).set({
                field1: inputa,
                field2: inputb,
                field3: inputc,
                productName: image.name || '',
                productPrice: image.price || 0,
                submitDate: submitDate,
                submitTime: submitTime,
                submittedDate: firebase.database.ServerValue.TIMESTAMP
              }).then(() => {
                $scope.showItemAdded = true;
                $timeout(() => {
                  $scope.showItemAdded = false;
                }, 2000);
              }).catch((error) => {
                console.error('Error adding item:', error.message, error.stack);
              });
            }
          } catch (error) {
            console.error('submitData failed:', error.message, error.stack);
          }
        };

        $scope.markOutOfStock = function(image) {
          try {
            if (!image || !image.$id) {
              console.error('markOutOfStock: image or image.$id is null or undefined');
              return;
            }
            var databaseRef = firebaseFetch.database().ref(image.$id);
            databaseRef.update({
              outOfStock: true,
              lastModified: firebase.database.ServerValue.TIMESTAMP
            }).then(function() {
              image.outOfStock = true;
              image.lastModified = Date.now();
            }).catch(function(error) {
              console.error('Error updating stock status:', error.message, error.stack);
            });
          } catch (error) {
            console.error('markOutOfStock failed:', error.message, error.stack);
          }
        };

        $scope.logout = function() {
          try {
            localStorage.removeItem('name');
            localStorage.removeItem('mobile');
            localStorage.removeItem('loggedIn');
            $window.location.href = '/mywebsite/index.html';
          } catch (error) {
            console.error('logout failed:', error.message, error.stack);
          }
        };

        $scope.applyFilter = function() {
          try {
            $scope.$applyAsync(); // Ensure the view updates
          } catch (error) {
            console.error('applyFilter failed:', error.message, error.stack);
          }
        };

        $scope.showEnlargedImage = function(src) {
          try {
            showEnlargedImage(src);
          } catch (error) {
            console.error('showEnlargedImage scope failed:', error.message, error.stack);
          }
        };

        $scope.closeEnlargedImage = function() {
          try {
            closeEnlargedImage();
          } catch (error) {
            console.error('closeEnlargedImage scope failed:', error.message, error.stack);
          }
        };
      }]);

      angular.module('myApp').directive('customOnChange', function() {
        return {
          restrict: 'A',
          link: function(scope, element, attrs) {
            try {
              var onChangeHandler = scope.$eval(attrs.customOnChange);
              element.bind('change', onChangeHandler);
            } catch (error) {
              console.error('customOnChange directive failed:', error.message, error.stack);
            }
          }
        };
      });
    } catch (error) {
      console.error('Angular module initialization failed:', error.message, error.stack);
    }
  </script>
</body>
</html>
